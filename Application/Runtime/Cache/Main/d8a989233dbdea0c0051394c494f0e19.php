<?php if (!defined('THINK_PATH')) exit();?><!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>查询系统</title>
    <link rel="stylesheet" href="/Public/frame/layui/css/layui.css">
    <link rel="stylesheet" href="/Public/frame/static/css/style.css">
    <!-- <link rel="stylesheet" href="/Public/frame/static/css/xtree.css"> -->
    <link rel="icon" href="/Public/frame/static/image/code.png">
    <script type="text/javascript" src="/Public/frame/layui/layui.js"></script>
    <script type="text/javascript" src="/Public/frame/static/js/vip_comm.js"></script>

	<script type="text/javascript" src="/Public/frame/static/js/layui-xtree.js"></script>
</head>
<body>
<style type="text/css">    .laytable-cell-1-qrcode{        height: 100%;        max-width: 100%;    }</style><fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;">    <legend>信息管理</legend></fieldset><div class="layui-tab">    <div class="layui-tab-content">        <div class="layui-tab-item layui-show">            <!-- layui 自动渲染 -->            <table id="inforData" lay-filter="test"></table>            <script type="text/html" id="opFunBtn">                <a class="layui-btn layui-btn-normal layui-btn-xs" lay-event="download" >下载二维码</a>                <a class="layui-btn layui-btn-xs" lay-event="edit">编辑</a>                <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">删除</a>            </script>        </div>    </div></div><script>    layui.use(['table','vip_table', 'layer','element','form'],function() {        var table = layui.table,            vipTable = layui.vip_table,            layer = layui.layer,            $ = layui.jquery,            form = layui.form;        table.render({            elem: '#inforData',            height: vipTable.getFullHeight(),            cellMinWidth: 50,            cols: [[                {                    field: 'file_name',                    title: '文件名'                },                {                    field: 'type',                    title: '类型',                    align: 'center'                },                {                    field: 'status',                    title: '状态',                    align: 'center'                },                {                    field: 'create_time',                    title: '创建时间',                    align: 'center'                },                {                    field: 'qrcode',                    title: '二维码',                    align: 'center',                    templet:function (d) {                        console.log(d.qrcode)                        return "<div><img src='/Public/"+d.qrcode+"'></div>"                    }                },                {                    title: '操作',                    align: 'center',                    toolbar: '#opFunBtn',                }            ]],            url: '<?php echo U("Tables/getData");?>',            response:{                statusName: 'errno',                statusCode: 0,                msgName: 'errmsg',                dataName: 'data'            },        });        function getPicture(p){            var str ="";            if(p!=null&&p!=""){                str= "<img src="+"<%=fileprefix_imgs%>"+p+">";            }            return str;        }        //监听工具条        table.on('tool(test)',function(obj) {            var data = obj.data,                id   = data.id,                username = data.username;            if (obj.event === 'download'){                window.open("<?php echo U('Tables/downPic');?>?id="+id)            }            if (obj.event === 'del') {                layer.confirm('确定删除此条？',function(index) {                    $.ajax({                        url: '<?php echo U("Tables/del");?>',                        type: 'POST',                        dataType: 'json',                        data: {id: id},                        success: function(res){                            if(res.errno == 0){                                // 删除成功后调用                                obj.del();                                layer.close(index);                                layer.msg("删除成功",{icon:1,time:2000});                            }else{                                layer.msg(res.errmsg,{icon:2});                            }                        },                        error : function(res){                            layer.msg("提交异常,请重试");                        }                    })                });            }            if (obj.event === 'edit') {                alert("功能暂未开放")            }        });        // 验证        form.verify({            userName:function(value,userName){                if(new RegExp("[^\x00-\xff]").test(value)){                    return "用户名不能输入中文";                }                if(value.length>16){                    return "用户名长度控制在16个字之内";                }            },            nickName:function(value,nickName){                if(!new RegExp("[^\x00-\xff]").test(value)){                    return "姓名只能输入中文";                }                if(value.length>6){                    return "姓名长度控制在6个字之内";                }            },            passWord:function(value,passWord){                if(value.length<6){                    return "密码不能低于6位数";                }            },        });        // 提交    });</script>
</body>
</html>